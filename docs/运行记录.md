# 运行记录

## 环境搭建

### 安装 CMake

```bash
$ sudo yum install openssl openssl-devel
$ openssl version -a

$ wget https://cmake.org/files/v3.25/cmake-3.25.2.tar.gz
$ tar -xvzf cmake-3.25.2.tar.gz
$ ./bootstrap 
$ make -j8
$ sudo make install
$ ln -s /usr/local/bin/cmake /usr/bin/
$ hash -r
$ cmake --version  # 检查是否安装成功
```

### 安装 boost、muduo 网络库

> + [boost库源码编译安装](https://blog.csdn.net/QIANGWEIYUAN/article/details/88792874)
> + [Linux平台下muduo网络库源码编译安装](https://blog.csdn.net/QIANGWEIYUAN/article/details/89023980)

安装包已下载至本地

```bash
$ ls
boost_1_69_0.tar.gz  muduo-master.zip
```

+ boost

  ```bash
  $  tar -zxvf boost_1_69_0.tar.gz 
  $ cd boost_1_69_0/
  $ ./bootstrap.sh
  $ ./b2
  ···
  ./boost/thread/pthread/thread_data.hpp:60:5: error: missing binary operator before token "("
     60 | #if PTHREAD_STACK_MIN > 0
  ···
  
  # https://github.com/boostorg/thread/issues/364
  # 在thread_data.hpp中加入
  #undef PTHREAD_STACK_MIN
  #define PTHREAD_STACK_MIN 16384
  
  $ ./b2
  The Boost C++ Libraries were successfully built!
  
  The following directory should be added to compiler include paths:
  
      /home/chang/boost_1_69_0
  
  The following directory should be added to linker library paths:
  
      /home/chang/boost_1_69_0/stage/lib
  $ ./b2 install  # root 执行
  ```

  ```c++
  // 示例 demo
  // 测试 boost 是否安装成功
  #include <iostream>
  #include <boost/bind.hpp>
  #include <string>
  using namespace std;
  
  class Hello {
  public:
  	void say(string name) { 
          cout << name << " say: hello world!" << endl; 
      }
  };
  
  int main() {
  	Hello h;
  	auto func = boost::bind(&Hello::say, &h, "zhang san");
  	func();
  	return 0;
  }
  
  // 编译运行输出
  // zhang san say: hello world!
  ```

+ muduo

  ```bash
  $ unzip muduo-master.zip
  $ cd muduo-master
  $ vi CMakeLists.txt
  # 注释该行
  #  option(MUDUO_BUILD_EXAMPLES "Build Muduo examples" ON)
  $ ./build.sh
  [100%] Built target muduo_inspect
  $ ./build.sh install
  
  $ cd /home/chang/build/release-install-cpp11
  $ ls
  include  lib
  
  $ cd include/
  $ ls
  muduo
  $ sudo mv muduo/ /usr/include/
  
  $ cd ../lib/
  $ ls
  libmuduo_base.a  libmuduo_http.a  libmuduo_inspect.a  libmuduo_net.a
  $ sudo mv * /usr/local/lib/
  ```

  ```c++
  // 示例 demo
  #include <muduo/net/TcpServer.h>
  #include <muduo/base/Logging.h>
  #include <boost/bind.hpp>
  #include <muduo/net/EventLoop.h>
  
  // 使用muduo开发回显服务器
  class EchoServer{
  public:
      EchoServer(muduo::net::EventLoop* loop,
                 const muduo::net::InetAddress& listenAddr);
  
      void start(); 
  
  private:
      void onConnection(const muduo::net::TcpConnectionPtr& conn);
  
      void onMessage(const muduo::net::TcpConnectionPtr& conn,
                     muduo::net::Buffer* buf,
                     muduo::Timestamp time);
  
      muduo::net::TcpServer server_;
  };
  
  EchoServer::EchoServer(muduo::net::EventLoop* loop, const muduo::net::InetAddress& listenAddr)
      : server_(loop, listenAddr, "EchoServer") {
        
    server_.setConnectionCallback(boost::bind(&EchoServer::onConnection, this, _1));
    server_.setMessageCallback(boost::bind(&EchoServer::onMessage, this, _1, _2, _3));
  }
  
  void EchoServer::start() {
      server_.start();
  }
  
  void EchoServer::onConnection(const muduo::net::TcpConnectionPtr& conn) {
      LOG_INFO << "EchoServer - " << conn->peerAddress().toIpPort() << " -> "
               << conn->localAddress().toIpPort() << " is "
               << (conn->connected() ? "UP" : "DOWN");
  }
  
  void EchoServer::onMessage(const muduo::net::TcpConnectionPtr& conn,
                             muduo::net::Buffer* buf,
                             muduo::Timestamp time) {
      // 接收到所有的消息，然后回显
      muduo::string msg(buf->retrieveAllAsString());
      LOG_INFO << conn->name() << " echo " << msg.size() << " bytes, "
               << "data received at " << time.toString();
      conn->send(msg);
  }
  
  
  int main() {
      LOG_INFO << "pid = " << getpid();
      muduo::net::EventLoop loop;
      muduo::net::InetAddress listenAddr(8888);
      EchoServer server(&loop, listenAddr);
      server.start();
      loop.loop();
  }
  
  // 编译
  // g++ main.cpp -lmuduo_net -lmuduo_base -lpthread -std=c++11
  ```

  ```bash
  # 服务端运行
  $ ./a.out 
  ```

  ```bash
  # 客户端连接
  $ $ echo "hello world" | nc localhost 8888
  hello world
  ```

### 安装 MySQL

```bash
# 查看系统是否有安装 mariadb
$ rpm -qa | grep postfix
postfix-2.10.1-9.el7.x86_64
$ rpm -qa | grep mariadb
mariadb-libs-5.5.68-1.el7.x86_64

# 卸载系统自带的 mariadb
$ rpm -e postfix-2.10.1-9.el7.x86_64
$ rpm -e mariadb-libs-5.5.68-1.el7.x86_64

# 安装 yum 源
$ wget -i -c http://dev.mysql.com/get/mysql57-community-release-el7-10.noarch.rpm
$ sudo yum -y install mysql57-community-release-el7-10.noarch.rpm
# 安装 mysql
$ sudo yum -y install mysql-community-server
$ sudo yum install mysql-devel  # 用 C++ 连接

warning: /var/cache/yum/x86_64/7/mysql57-community/packages/mysql-community-common-5.7.41-1.el7.x86_64.rpm: Header V4 RSA/SHA256 Signature, key ID 3a79bd29: NOKEY
Retrieving key from file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql

The GPG keys listed for the "MySQL 5.7 Community Server" repository are already installed but they are not correct for this package.
Check that the correct key URLs are configured for this repository.

 Failing package is: mysql-community-common-5.7.41-1.el7.x86_64
 GPG Keys are configured as: file:///etc/pki/rpm-gpg/RPM-GPG-KEY-mysql
 
$ sudo rpm --import https://repo.mysql.com/RPM-GPG-KEY-mysql-2022
$ sudo yum install mysql-devel
```

### 安装 Redis

```bash

```

### 安装 Nginx

## 编译运行

