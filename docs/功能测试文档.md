# 功能测试文档

## 环境测试

### JSON 库测试

> + json 在该项目中作为服务端与客户端的通信格式，项目中使用的三方 json 库用于对传输数据进行序列化、反序列化
> + 该项目使用的 json 三方库，在使用时直接包含相应头文件即可

+ [testjson.cpp](../test/testjson/testjson.cpp)
+ 序列化：将对象（C++ 中的 int、string 对象等）转换为字节流（json 格式字符串），便于在网络传输或保存在本地文件中
+ 反序列化：根据字节流中保存的对象状态及描述信息，解析 json 格式字符串，重建对象

### muduo 网络库测试

+ [muduo_server.cpp](../test/testmuduo/muduo_server.cpp)
  + 编译：`$ g++ -o server muduo_server.cpp -lmuduo_net -lmuduo_base -lpthread`
  + 服务端运行：`$ ./server`
  + 客户端运行：`$ telnet 127.0.0.1 6000`
+ muduo 网络库核心模块见我另一个 repo：[Chang-Chiang/muduo (github.com)](https://github.com/Chang-Chiang/muduo)
  + 底层基于 epoll + 线程池
  + 主要提供给用户两个类
    + TcpServer ： 用于编写服务器程序
    + TcpClient ： 用于编写客户端程序
+ 在该项目中使用 muduo 网络库用于解耦 网络 I/O 部分代码（用户的连接和断开）、业务代码（用户的可读写事件）
+ 基于 muduo 网络库开发服务器流程
  1. 组合 TcpServer 对象

  2. 创建 EventLoop 事件循环对象的指针

  3. 明确 TcpServer 构造函数需要什么参数，输出 ChatServer 的构造函数

  4. 在当前服务器类的构造函数当中，注册处理连接的回调函数和处理读写时间的回调函数

  5. 设置合适的服务端线程数量，muduo 库会自己分配 I/O 线程和 worker 线程

### MySQL 数据库测试

+ 查看 MySQL 运行状态：`$ sudo service mysql status`
+ 启动 MySQL：`$ sudo service mysql start`
+ 连接 MySQL：`$ mysql -u root -p`，我的 mysql 密码为 123456
+ 切换数据库：`mysql> use chat;`
+ 其他相关表操作：`mysql> select * from user;`

### Nginx 负载均衡环境测试

+ 查看是否运行：`$ netstat -tanp`
+ 启动：`# /usr/local/nginx/sbin/nginx`
+ 修改配置文件，配置负载均衡
  + nginx 端口，客户端连接服务器时则统一访问该端口
  + 服务器地址，客户端连接服务器时，nginx 将请求转到服务器
+ 平滑加载配置文件启动：`# /usr/local/nginx/sbin/nginx -s reload`
+ 启动多台服务器
+ 启动客户端，访问 Nginx 负载均衡器

### Redis 测试

+ 查看 redis server 启用状态（下面两种方式二选一）：
  + `$ ps -ef | grep redis`
  + `$ sudo netstat -tanp`
+ 进入 redis client：`$ redie-cli`
  + 设置键值对：`127.0.0.1:6379> set "abc" "hello world"`
  + 获取键对应的值：`127.0.0.1:6379> get "abc" `
  + 订阅 13 通道：`subscribe 13`
  + 向 13 通道发布消息：`publish 13 "hello wo"`

## 功能测试

### 注册



### 登录

### 一对一在线聊天

### 离线消息

### 添加好友

### 创建群组

### 添加群组

### 群组聊天

### 客户端异常掉线

### 服务端异常掉线

## 部署测试

### Nginx 负载均衡

### Redis 消息队列

